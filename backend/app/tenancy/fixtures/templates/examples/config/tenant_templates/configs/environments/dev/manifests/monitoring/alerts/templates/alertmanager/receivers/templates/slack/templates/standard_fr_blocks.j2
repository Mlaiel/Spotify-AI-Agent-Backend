{
    "blocks": [
        {
            "type": "header",
            "text": {
                "type": "plain_text",
                "text": "{{ get_severity_emoji(alert.severity) }} üö® ALERTE {{ alert.severity.upper() }} - {{ alert.context.service_name }}",
                "emoji": true
            }
        },
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*{{ alert.title }}*\n{{ alert.description | truncate_smart(300) }}"
            },
            "accessory": {
                "type": "button",
                "text": {
                    "type": "plain_text",
                    "text": "üéõÔ∏è Voir D√©tails",
                    "emoji": true
                },
                "style": "{% if alert.severity in ['critical', 'emergency'] %}danger{% else %}primary{% endif %}",
                "action_id": "view_alert_details",
                "url": "{{ dashboard_url }}/alerts/{{ alert.alert_id }}",
                "value": "{{ alert.alert_id }}"
            }
        },
        {
            "type": "section",
            "fields": [
                {
                    "type": "mrkdwn",
                    "text": "*üéØ Service:*\n`{{ alert.context.service_name }}`"
                },
                {
                    "type": "mrkdwn",
                    "text": "*üåç Environnement:*\n{{ environment | upper }}"
                },
                {
                    "type": "mrkdwn",
                    "text": "*üîß Composant:*\n{{ alert.context.component }}"
                },
                {
                    "type": "mrkdwn",
                    "text": "*‚è∞ D√©clench√©:*\n{{ format_date(alert.created_at, 'short') }}"
                },
                {
                    "type": "mrkdwn",
                    "text": "*‚ö° S√©v√©rit√©:*\n{{ alert.severity | upper }} ({{ alert.priority_score | default(0) }}/10)"
                },
                {
                    "type": "mrkdwn",
                    "text": "*‚è±Ô∏è Dur√©e:*\n{{ alert.duration | duration_format | default('Nouveau') }}"
                }
            ]
        },
        {% if alert.context.instance_id %}
        {
            "type": "section",
            "fields": [
                {
                    "type": "mrkdwn",
                    "text": "*üñ•Ô∏è Instance:*\n`{{ alert.context.instance_id }}`"
                },
                {
                    "type": "mrkdwn",
                    "text": "*üèóÔ∏è Cluster:*\n`{{ alert.context.cluster_name | default('d√©faut') }}`"
                },
                {
                    "type": "mrkdwn",
                    "text": "*üåê R√©gion:*\n{{ alert.context.region | default('global') }}"
                },
                {
                    "type": "mrkdwn",
                    "text": "*üì¶ Namespace:*\n{{ alert.context.namespace | default('d√©faut') }}"
                }
            ]
        },
        {% endif %}
        {% if alert.metrics %}
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*üìä M√©triques Cl√©s:*\n{% for metric_name, metric_value in alert.metrics.items() %}‚Ä¢ *{{ metric_name | title }}:* {{ metric_value }}\n{% endfor %}"
            }
        },
        {% endif %}
        {% if alert.business_impact %}
        {
            "type": "section",
            "fields": [
                {
                    "type": "mrkdwn",
                    "text": "*üíº Impact Business:*\n{{ alert.business_impact.level | title }}"
                },
                {
                    "type": "mrkdwn",
                    "text": "*üë• Utilisateurs Affect√©s:*\n{{ alert.business_impact.affected_users | default('Inconnu') }}"
                },
                {
                    "type": "mrkdwn",
                    "text": "*üìà SLA:*\n{{ alert.business_impact.sla_breach | ternary('‚ö†Ô∏è Violation', '‚úÖ OK') }}"
                },
                {
                    "type": "mrkdwn",
                    "text": "*üí∞ Co√ªt Estim√©:*\n{{ alert.business_impact.estimated_cost | default('En √©valuation') }}"
                }
            ]
        },
        {% endif %}
        {% if alert.ai_insights and alert.ai_insights.recommended_actions %}
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*ü§ñ Recommandations IA (Auto-g√©n√©r√©es):*\n{% for action in alert.ai_insights.recommended_actions[:4] %}{{ loop.index }}. {{ action }}\n{% endfor %}"
            }
        },
        {% endif %}
        {% if alert.ai_insights and alert.ai_insights.root_cause_analysis %}
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*üîç Analyse Cause Racine:*\n{{ alert.ai_insights.root_cause_analysis | truncate(200) }}"
            }
        },
        {% endif %}
        {% if alert.related_alerts %}
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*üîó Alertes Li√©es ({{ alert.related_alerts | length }}):*\n{% for related in alert.related_alerts[:3] %}‚Ä¢ {{ related.service }} - {{ related.title }}\n{% endfor %}{% if alert.related_alerts | length > 3 %}\n... et {{ alert.related_alerts | length - 3 }} de plus{% endif %}"
            }
        },
        {% endif %}
        {
            "type": "actions",
            "elements": [
                {
                    "type": "button",
                    "text": {
                        "type": "plain_text",
                        "text": "‚úÖ Acquitter",
                        "emoji": true
                    },
                    "style": "primary",
                    "action_id": "acknowledge_alert",
                    "value": "{{ alert.alert_id }}"
                },
                {
                    "type": "button",
                    "text": {
                        "type": "plain_text",
                        "text": "üîß R√©soudre",
                        "emoji": true
                    },
                    "style": "primary", 
                    "action_id": "resolve_alert",
                    "value": "{{ alert.alert_id }}"
                },
                {% if alert.severity in ['critical', 'emergency'] %}
                {
                    "type": "button",
                    "text": {
                        "type": "plain_text",
                        "text": "üî• Escalader",
                        "emoji": true
                    },
                    "style": "danger",
                    "action_id": "escalate_alert",
                    "value": "{{ alert.alert_id }}"
                },
                {% endif %}
                {
                    "type": "button",
                    "text": {
                        "type": "plain_text",
                        "text": "üìä M√©triques",
                        "emoji": true
                    },
                    "action_id": "view_metrics",
                    "url": "{{ metrics_url }}/d/{{ alert.context.service_name }}",
                    "value": "{{ alert.alert_id }}"
                }
            ]
        },
        {
            "type": "actions",
            "elements": [
                {
                    "type": "button",
                    "text": {
                        "type": "plain_text",
                        "text": "üìã Logs Service",
                        "emoji": true
                    },
                    "url": "{{ logs_url }}/app/{{ alert.context.service_name }}"
                },
                {
                    "type": "button",
                    "text": {
                        "type": "plain_text",
                        "text": "üîß Infrastructure",
                        "emoji": true
                    },
                    "url": "{{ dashboard_url }}/infrastructure/{{ alert.context.cluster_name }}"
                },
                {% if alert.context.trace_id %}
                {
                    "type": "button",
                    "text": {
                        "type": "plain_text",
                        "text": "üîç Tracing",
                        "emoji": true
                    },
                    "url": "{{ tracing_url }}/trace/{{ alert.context.trace_id }}"
                },
                {% endif %}
                {
                    "type": "button",
                    "text": {
                        "type": "plain_text",
                        "text": "üìö Runbook",
                        "emoji": true
                    },
                    "url": "{{ runbook_url }}/{{ alert.context.service_name }}"
                }
            ]
        },
        {% if alert.escalation %}
        {
            "type": "context",
            "elements": [
                {
                    "type": "mrkdwn",
                    "text": "‚ö° *Escalade automatique dans:* {{ alert.escalation.escalation_time | default('15 minutes') }} | *Astreinte:* @{{ alert.escalation.primary_oncall | default('√©quipe-devops') }} | *Backup:* @{{ alert.escalation.secondary_oncall | default('√©quipe-backup') }}"
                }
            ]
        },
        {% endif %}
        {
            "type": "divider"
        },
        {
            "type": "context",
            "elements": [
                {
                    "type": "mrkdwn",
                    "text": "üéµ *Spotify AI Agent Monitoring* | ID: `{{ alert.alert_id }}` | Corr√©lation: `{{ alert.correlation_id | default('N/A') }}` | Tenant: `{{ alert.tenant_id | default('syst√®me') }}` | {{ format_date(now, 'iso') }}"
                }
            ]
        }
    ]
}